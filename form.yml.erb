# Batch Connect app configuration file
#
# @note Used to define the submitted cluster, title, description, and
#   hard-coded/user-defined attributes that make up this Batch Connect app.
<%-
  cpu_queues = OodAppkit.clusters[:hpc].custom_config[:cpu_queues]
  gpu_queues = OodAppkit.clusters[:hpc].custom_config[:gpu_queues]
  gpu_select_queues = OodAppkit.clusters[:hpc].custom_config[:gpu_select_queues]
-%>
---

# **MUST** set cluster id here that matches cluster configuration file located
# under /etc/ood/config/clusters.d/*.yml
cluster: "hpc"

# Define attribute values that aren't meant to be modified by the user within
# the Dashboard form
attributes:
  modules: "Nextflow/24.10.2"

  choose_queue: 
    widget: "select"
    label: "Queue"
    help: "Please select a queue from the drop-down."
    options:
    <%- cpu_queues.each do |q| -%>
      - [ "<%= q %>", "<%= q %>", data-set-gpu-job: 'false', data-hide-num-gpus: true, data-hide-gpu-type: true ]
    <%- end -%>
  
  single_node: 1
  num_cores: 1
  mem_size: 8000

 
  ################
  # App Specific #
  ################
  #
  pipeline_name:
    widget: "text_field"
    label: "Pipeline Name or URL"
    help: >
      The name or URL of the Nextflow pipeline you want to run.
      Pipelines hosted on Github can be launched with just the name.
      For example, `nf-core/rnaseq`, where "nf-core" is the user and "rnaseq" is the repository.
      If the pipeline is not hosted on Github, a full URL is required.

  version: 
  widget: "text_field"
  label: "Nextflow Pipeline Version"
  help: >
    Leave blank to run the latest. 
    If you are running an nf-core pipeline, you have the option of using `dev`. 
    It's highly recommended to use versioned releases of pipelines.

  run_uid:
    widget: "text_field"
    label: "Run Unique Name"
    help: |
      The run's name should be unique and must be reused to resume running a pipeline.
  
  custom_config:
    label: "Custom Configuration File"
    data-filepicker: true
    data-target-file-type: files # Valid values are: files, dirs, or both
    readonly: false
    help: "Select your custom configuration file; leave blank to use the default (recommended unless you know what you're doing)."

  nextflow_params:
    label: "Nextflow Params File"
    data-filepicker: true
    data-target-file-type: files # Valid values are: files, dirs, or both
    readonly: false
    help: "Select your parameters file (JSON or YAML)."



# All of the attributes that make up the Dashboard form (in respective order),
# and made available to the submit configuration file and the template ERB
# files
#
# @note You typically do not need to modify this unless you want to add a new
#   configurable value
# @note If an attribute listed below is hard-coded above in the `attributes`
#   option, then it will not appear in the form page that the user sees in the
#   Dashboard
form:
  - modules
  - choose_queue
  - pipeline_name
  - version
  - run_uid
  - num_cores
  - single_node
  - mem_size
  - num_gpus
  - nextflow_params
  - custom_config
  - bc_num_hours
  - bc_email_on_started
